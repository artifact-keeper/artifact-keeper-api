openapi: "3.1.0"
info:
  title: Artifact Keeper API
  version: "1.0.0"
  description: >-
    REST API for Artifact Keeper, an open-source universal artifact registry.
    Covers user management, repositories, artifacts, search, security scanning,
    plugins, edge nodes, migration, and administration. Format-specific protocol
    endpoints (npm, PyPI, Maven, Docker/OCI, etc.) are not included; those follow
    their respective upstream specifications.
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT
  contact:
    url: https://github.com/artifact-keeper/artifact-keeper

servers:
  - url: http://localhost:8080
    description: Local development
  - url: https://{domain}
    description: Production
    variables:
      domain:
        default: registry.example.com

security:
  - bearerAuth: []
  - apiKeyAuth: []

tags:
  - name: Health
    description: Service health and readiness probes
  - name: Auth
    description: Authentication and session management
  - name: Users
    description: User accounts, roles, and API tokens
  - name: Repositories
    description: Artifact repository management
  - name: Artifacts
    description: Individual artifact operations
  - name: Search
    description: Full-text and faceted search
  - name: Groups
    description: User group management
  - name: Permissions
    description: Access control and permission grants
  - name: Webhooks
    description: Event notification webhooks
  - name: Plugins
    description: WASM plugin lifecycle management
  - name: Formats
    description: Package format handler registry
  - name: Signing
    description: Artifact signing and verification
  - name: Security
    description: Vulnerability scanning and security policies
  - name: Edge Nodes
    description: Edge node management and content replication
  - name: Admin
    description: System administration and backups
  - name: Migration
    description: Registry migration from Artifactory/Nexus
  - name: Builds
    description: Build information tracking
  - name: Packages
    description: Package-level views across versions
  - name: Tree
    description: Repository file tree browsing

paths:
  /health:
    get:
      operationId: getHealth
      tags: [Health]
      summary: Health check
      description: Returns the health status of the service and its dependencies including database, storage, and scanner subsystems.
      security: []
      responses:
        "200":
          description: Service health status
          content:
            application/json:
              schema:
                type: object
                required: [status, database, storage, scanner]
                properties:
                  status:
                    type: string
                    enum: [healthy, degraded, unhealthy]
                    example: healthy
                  database:
                    $ref: "#/components/schemas/ComponentHealth"
                  storage:
                    $ref: "#/components/schemas/ComponentHealth"
                  scanner:
                    $ref: "#/components/schemas/ComponentHealth"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /ready:
    get:
      operationId: getReadiness
      tags: [Health]
      summary: Readiness probe
      description: Returns whether the service is ready to accept traffic. Intended for use by container orchestrators and load balancers.
      security: []
      responses:
        "200":
          description: Readiness status
          content:
            application/json:
              schema:
                type: object
                required: [ready]
                properties:
                  ready:
                    type: boolean
                    example: true
        "500":
          $ref: "#/components/responses/InternalServerError"

  /metrics:
    get:
      operationId: getMetrics
      tags: [Health]
      summary: Prometheus metrics
      description: Returns Prometheus-formatted metrics for monitoring and alerting.
      security: []
      responses:
        "200":
          description: Prometheus metrics in text exposition format
          content:
            text/plain:
              schema:
                type: string
        "500":
          $ref: "#/components/responses/InternalServerError"

  # =============================================================================
  # Auth Endpoints
  # =============================================================================

  /api/v1/auth/login:
    post:
      operationId: login
      tags: [Auth]
      summary: Authenticate user
      description: Authenticates a user with username and password credentials and returns access and refresh tokens.
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [username, password]
              properties:
                username:
                  type: string
                  minLength: 1
                  example: admin
                password:
                  type: string
                  format: password
                  minLength: 1
                  example: secret123
      responses:
        "200":
          description: Authentication successful
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TokenPair"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/auth/logout:
    post:
      operationId: logout
      tags: [Auth]
      summary: Logout user
      description: Invalidates the current session and associated tokens.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        "204":
          description: Successfully logged out
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/auth/refresh:
    post:
      operationId: refreshToken
      tags: [Auth]
      summary: Refresh access token
      description: Exchanges a valid refresh token for a new access and refresh token pair.
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [refresh_token]
              properties:
                refresh_token:
                  type: string
                  description: The refresh token obtained from login or a previous refresh call.
      responses:
        "200":
          description: Token refreshed successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TokenPair"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/auth/me:
    get:
      operationId: getCurrentUser
      tags: [Auth]
      summary: Get current user
      description: Returns the profile of the currently authenticated user.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        "200":
          description: Current user profile
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/User"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalServerError"

  # =============================================================================
  # Users Endpoints
  # =============================================================================

  /api/v1/users:
    get:
      operationId: listUsers
      tags: [Users]
      summary: List users
      description: Returns a paginated list of users with optional filtering by search term and active status.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: search
          in: query
          description: Filter users by username, email, or display name.
          schema:
            type: string
        - name: is_active
          in: query
          description: Filter by active status.
          schema:
            type: boolean
        - $ref: "#/components/parameters/page"
        - $ref: "#/components/parameters/perPage"
      responses:
        "200":
          description: Paginated list of users
          content:
            application/json:
              schema:
                type: object
                required: [items, pagination]
                properties:
                  items:
                    type: array
                    items:
                      $ref: "#/components/schemas/User"
                  pagination:
                    $ref: "#/components/schemas/Pagination"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "500":
          $ref: "#/components/responses/InternalServerError"

    post:
      operationId: createUser
      tags: [Users]
      summary: Create user
      description: Creates a new user account. Requires admin privileges.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [username, email, display_name, is_admin]
              properties:
                username:
                  type: string
                  minLength: 3
                  maxLength: 64
                  example: jdoe
                email:
                  type: string
                  format: email
                  example: jdoe@example.com
                password:
                  type: string
                  format: password
                  description: Optional. If omitted, a temporary password is generated.
                display_name:
                  type: string
                  maxLength: 128
                  example: Jane Doe
                is_admin:
                  type: boolean
                  default: false
      responses:
        "201":
          description: User created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/User"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "409":
          $ref: "#/components/responses/Conflict"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/users/{id}:
    get:
      operationId: getUser
      tags: [Users]
      summary: Get user by ID
      description: Returns a single user by their unique identifier.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: User UUID
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: User details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/User"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

    patch:
      operationId: updateUser
      tags: [Users]
      summary: Update user
      description: Partially updates a user's profile. Requires admin privileges or ownership of the account.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: User UUID
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                  format: email
                display_name:
                  type: string
                  maxLength: 128
                is_active:
                  type: boolean
                is_admin:
                  type: boolean
      responses:
        "200":
          description: User updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/User"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          $ref: "#/components/responses/Conflict"
        "500":
          $ref: "#/components/responses/InternalServerError"

    delete:
      operationId: deleteUser
      tags: [Users]
      summary: Delete user
      description: Permanently deletes a user account. Requires admin privileges.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: User UUID
          schema:
            type: string
            format: uuid
      responses:
        "204":
          description: User deleted
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/users/{id}/roles:
    get:
      operationId: listUserRoles
      tags: [Users]
      summary: List user roles
      description: Returns all roles assigned to the specified user.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: User UUID
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: List of roles
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Role"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

    post:
      operationId: assignUserRole
      tags: [Users]
      summary: Assign role to user
      description: Assigns an existing role to the specified user. Requires admin privileges.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: User UUID
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [role_id]
              properties:
                role_id:
                  type: string
                  format: uuid
      responses:
        "201":
          description: Role assigned
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          $ref: "#/components/responses/Conflict"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/users/{id}/roles/{roleId}:
    delete:
      operationId: removeUserRole
      tags: [Users]
      summary: Remove role from user
      description: Removes a role assignment from the specified user. Requires admin privileges.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: User UUID
          schema:
            type: string
            format: uuid
        - name: roleId
          in: path
          required: true
          description: Role UUID
          schema:
            type: string
            format: uuid
      responses:
        "204":
          description: Role removed
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/users/{id}/tokens:
    get:
      operationId: listUserTokens
      tags: [Users]
      summary: List API tokens
      description: Returns all API tokens for the specified user. Token values are not included in the response.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: User UUID
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: List of API tokens
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/ApiToken"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

    post:
      operationId: createUserToken
      tags: [Users]
      summary: Create API token
      description: >-
        Creates a new API token for the specified user. The token value is only
        returned in the creation response and cannot be retrieved afterwards.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: User UUID
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [name]
              properties:
                name:
                  type: string
                  minLength: 1
                  maxLength: 128
                  example: ci-deploy-token
                expires_at:
                  type: string
                  format: date-time
                  description: Token expiration timestamp. Omit for a non-expiring token.
                scopes:
                  type: array
                  items:
                    type: string
                  description: Optional list of permission scopes to restrict this token.
                  example: ["read:artifacts", "write:artifacts"]
      responses:
        "201":
          description: Token created
          content:
            application/json:
              schema:
                type: object
                required: [token, id, name, expires_at]
                properties:
                  token:
                    type: string
                    description: The plaintext token value. Store it securely; it cannot be retrieved again.
                  id:
                    type: string
                    format: uuid
                  name:
                    type: string
                  expires_at:
                    type: string
                    format: date-time
                    nullable: true
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/users/{id}/tokens/{tokenId}:
    delete:
      operationId: deleteUserToken
      tags: [Users]
      summary: Revoke API token
      description: Permanently revokes and deletes an API token.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: User UUID
          schema:
            type: string
            format: uuid
        - name: tokenId
          in: path
          required: true
          description: Token UUID
          schema:
            type: string
            format: uuid
      responses:
        "204":
          description: Token revoked
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/users/{id}/password:
    post:
      operationId: changePassword
      tags: [Users]
      summary: Change password
      description: Changes the password for the specified user. Requires the current password for verification.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: User UUID
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [current_password, new_password]
              properties:
                current_password:
                  type: string
                  format: password
                new_password:
                  type: string
                  format: password
                  minLength: 8
      responses:
        "204":
          description: Password changed
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/users/{id}/password/reset:
    post:
      operationId: resetPassword
      tags: [Users]
      summary: Reset user password
      description: Resets the user's password and returns a temporary password. Requires admin privileges.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: User UUID
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Password reset
          content:
            application/json:
              schema:
                type: object
                required: [temporary_password]
                properties:
                  temporary_password:
                    type: string
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  # =============================================================================
  # Repositories Endpoints
  # =============================================================================

  /api/v1/repositories:
    get:
      operationId: listRepositories
      tags: [Repositories]
      summary: List repositories
      description: Returns a paginated list of repositories with optional filtering by package format, repository type, and search term.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: format
          in: query
          description: Filter by package format (e.g. maven, npm, pypi, docker, generic).
          schema:
            type: string
        - name: type
          in: query
          description: Filter by repository type.
          schema:
            type: string
            enum: [local, remote, virtual]
        - name: search
          in: query
          description: Search repositories by key or name.
          schema:
            type: string
        - $ref: "#/components/parameters/page"
        - $ref: "#/components/parameters/perPage"
      responses:
        "200":
          description: Paginated list of repositories
          content:
            application/json:
              schema:
                type: object
                required: [items, pagination]
                properties:
                  items:
                    type: array
                    items:
                      $ref: "#/components/schemas/Repository"
                  pagination:
                    $ref: "#/components/schemas/Pagination"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalServerError"

    post:
      operationId: createRepository
      tags: [Repositories]
      summary: Create repository
      description: Creates a new artifact repository. Requires admin privileges.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [key, name, format, type]
              properties:
                key:
                  type: string
                  pattern: "^[a-z0-9][a-z0-9._-]*$"
                  minLength: 2
                  maxLength: 64
                  example: libs-release-local
                name:
                  type: string
                  maxLength: 128
                  example: Release Libraries
                format:
                  type: string
                  enum: [maven, npm, pypi, docker, cargo, nuget, go, helm, generic]
                  example: maven
                type:
                  type: string
                  enum: [local, remote, virtual]
                  example: local
                description:
                  type: string
                  maxLength: 512
                is_public:
                  type: boolean
                  default: false
      responses:
        "201":
          description: Repository created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Repository"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "409":
          $ref: "#/components/responses/Conflict"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/repositories/{key}:
    get:
      operationId: getRepository
      tags: [Repositories]
      summary: Get repository
      description: Returns detailed information about a single repository identified by its unique key.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: key
          in: path
          required: true
          description: Repository key (unique identifier)
          schema:
            type: string
      responses:
        "200":
          description: Repository details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Repository"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

    patch:
      operationId: updateRepository
      tags: [Repositories]
      summary: Update repository
      description: Partially updates repository metadata. Requires admin privileges.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: key
          in: path
          required: true
          description: Repository key
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  maxLength: 128
                description:
                  type: string
                  maxLength: 512
                is_public:
                  type: boolean
                quota_bytes:
                  type: integer
                  format: int64
                  description: Storage quota in bytes. Null for unlimited.
                  nullable: true
      responses:
        "200":
          description: Repository updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Repository"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

    delete:
      operationId: deleteRepository
      tags: [Repositories]
      summary: Delete repository
      description: >-
        Deletes a repository. By default, fails if the repository contains
        artifacts. Use the force query parameter to delete a repository and
        all its contents.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: key
          in: path
          required: true
          description: Repository key
          schema:
            type: string
        - name: force
          in: query
          description: Force deletion even if repository contains artifacts.
          schema:
            type: boolean
            default: false
      responses:
        "204":
          description: Repository deleted
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          $ref: "#/components/responses/Conflict"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/repositories/{key}/artifacts:
    get:
      operationId: listRepositoryArtifacts
      tags: [Repositories]
      summary: List artifacts in repository
      description: Returns a paginated list of artifacts within the specified repository with optional path prefix filtering.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: key
          in: path
          required: true
          description: Repository key
          schema:
            type: string
        - name: path_prefix
          in: query
          description: Filter artifacts whose path starts with this prefix.
          schema:
            type: string
        - name: search
          in: query
          description: Search within artifact names and paths.
          schema:
            type: string
        - $ref: "#/components/parameters/page"
        - $ref: "#/components/parameters/perPage"
      responses:
        "200":
          description: Paginated list of artifacts
          content:
            application/json:
              schema:
                type: object
                required: [items, pagination]
                properties:
                  items:
                    type: array
                    items:
                      $ref: "#/components/schemas/Artifact"
                  pagination:
                    $ref: "#/components/schemas/Pagination"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/repositories/{key}/artifacts/{path}:
    get:
      operationId: getRepositoryArtifact
      tags: [Repositories]
      summary: Get artifact info by path
      description: Returns metadata for a single artifact identified by its path within the repository. The path parameter is a catch-all that supports nested paths.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: key
          in: path
          required: true
          description: Repository key
          schema:
            type: string
        - name: path
          in: path
          required: true
          description: Artifact path within the repository (catch-all, e.g. org/example/lib/1.0/lib-1.0.jar)
          schema:
            type: string
      responses:
        "200":
          description: Artifact metadata
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Artifact"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

    put:
      operationId: uploadArtifact
      tags: [Repositories]
      summary: Upload artifact
      description: >-
        Uploads a binary artifact to the specified path within the repository.
        If an artifact already exists at the path it will be overwritten,
        creating a new version.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: key
          in: path
          required: true
          description: Repository key
          schema:
            type: string
        - name: path
          in: path
          required: true
          description: Target path within the repository
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/octet-stream:
            schema:
              type: string
              format: binary
      responses:
        "201":
          description: Artifact uploaded
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Artifact"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

    delete:
      operationId: deleteArtifact
      tags: [Repositories]
      summary: Delete artifact by path
      description: Permanently deletes the artifact at the specified path within the repository.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: key
          in: path
          required: true
          description: Repository key
          schema:
            type: string
        - name: path
          in: path
          required: true
          description: Artifact path within the repository
          schema:
            type: string
      responses:
        "204":
          description: Artifact deleted
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/repositories/{key}/download/{path}:
    get:
      operationId: downloadArtifact
      tags: [Repositories]
      summary: Download artifact
      description: Downloads the binary content of an artifact. The response Content-Type is determined by the artifact's MIME type.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: key
          in: path
          required: true
          description: Repository key
          schema:
            type: string
        - name: path
          in: path
          required: true
          description: Artifact path within the repository
          schema:
            type: string
      responses:
        "200":
          description: Artifact binary content
          content:
            application/octet-stream:
              schema:
                type: string
                format: binary
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  # =============================================================================
  # Artifacts (by ID) Endpoints
  # =============================================================================

  /api/v1/artifacts/{id}:
    get:
      operationId: getArtifact
      tags: [Artifacts]
      summary: Get artifact by ID
      description: Returns artifact metadata by its unique identifier. Optionally scope by repository key.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Artifact UUID
          schema:
            type: string
            format: uuid
        - name: repository_key
          in: query
          description: Optional repository key to scope the lookup.
          schema:
            type: string
      responses:
        "200":
          description: Artifact metadata
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Artifact"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/artifacts/{id}/metadata:
    get:
      operationId: getArtifactMetadata
      tags: [Artifacts]
      summary: Get artifact metadata
      description: Returns format-specific metadata for the artifact (e.g. Maven POM info, npm package.json fields, Docker manifest data).
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Artifact UUID
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Format-specific metadata
          content:
            application/json:
              schema:
                type: object
                additionalProperties: true
                description: Structure varies by artifact format.
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/artifacts/{id}/stats:
    get:
      operationId: getArtifactStats
      tags: [Artifacts]
      summary: Get artifact download stats
      description: Returns download statistics for the specified artifact.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Artifact UUID
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Download statistics
          content:
            application/json:
              schema:
                type: object
                required: [total_downloads, downloads_30d, last_downloaded_at]
                properties:
                  total_downloads:
                    type: integer
                    format: int64
                    example: 15432
                  downloads_30d:
                    type: integer
                    format: int64
                    example: 982
                  last_downloaded_at:
                    type: string
                    format: date-time
                    nullable: true
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  # =============================================================================
  # Search Endpoints
  # =============================================================================

  /api/v1/search/quick:
    get:
      operationId: quickSearch
      tags: [Search]
      summary: Quick search
      description: Performs a fast full-text search across all accessible artifacts. Suitable for search-as-you-type interfaces.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: q
          in: query
          required: true
          description: Search query string.
          schema:
            type: string
            minLength: 1
        - name: limit
          in: query
          description: Maximum number of results to return.
          schema:
            type: integer
            default: 10
            minimum: 1
            maximum: 100
      responses:
        "200":
          description: Search results
          content:
            application/json:
              schema:
                type: object
                required: [results]
                properties:
                  results:
                    type: array
                    items:
                      $ref: "#/components/schemas/SearchResult"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/search/advanced:
    get:
      operationId: advancedSearch
      tags: [Search]
      summary: Advanced search
      description: Performs a faceted search with filtering, sorting, and pagination support.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: q
          in: query
          required: true
          description: Search query string.
          schema:
            type: string
            minLength: 1
        - name: format
          in: query
          description: Filter by package format.
          schema:
            type: string
        - name: repository
          in: query
          description: Filter by repository key.
          schema:
            type: string
        - name: sort
          in: query
          description: Sort field.
          schema:
            type: string
            enum: [relevance, name, created_at, size, downloads]
            default: relevance
        - name: order
          in: query
          description: Sort order.
          schema:
            type: string
            enum: [asc, desc]
            default: desc
        - $ref: "#/components/parameters/page"
        - $ref: "#/components/parameters/perPage"
      responses:
        "200":
          description: Search results with facets
          content:
            application/json:
              schema:
                type: object
                required: [items, facets, pagination]
                properties:
                  items:
                    type: array
                    items:
                      $ref: "#/components/schemas/SearchResult"
                  facets:
                    type: object
                    additionalProperties:
                      type: array
                      items:
                        type: object
                        required: [value, count]
                        properties:
                          value:
                            type: string
                          count:
                            type: integer
                    description: Aggregated facets (e.g. format counts, repository counts).
                  pagination:
                    $ref: "#/components/schemas/Pagination"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/search/checksum:
    get:
      operationId: searchByChecksum
      tags: [Search]
      summary: Search by checksum
      description: Finds artifacts matching a given checksum. Provide at least one of sha256, sha1, or md5.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: sha256
          in: query
          description: SHA-256 hex digest
          schema:
            type: string
            pattern: "^[a-f0-9]{64}$"
        - name: sha1
          in: query
          description: SHA-1 hex digest
          schema:
            type: string
            pattern: "^[a-f0-9]{40}$"
        - name: md5
          in: query
          description: MD5 hex digest
          schema:
            type: string
            pattern: "^[a-f0-9]{32}$"
      responses:
        "200":
          description: Matching artifacts
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Artifact"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/search/suggest:
    get:
      operationId: searchSuggestions
      tags: [Search]
      summary: Autocomplete suggestions
      description: Returns search term suggestions based on a prefix. Useful for typeahead/autocomplete in the UI.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: prefix
          in: query
          required: true
          description: The prefix to generate suggestions for.
          schema:
            type: string
            minLength: 1
      responses:
        "200":
          description: Suggestions
          content:
            application/json:
              schema:
                type: object
                required: [suggestions]
                properties:
                  suggestions:
                    type: array
                    items:
                      type: string
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/search/trending:
    get:
      operationId: getTrendingArtifacts
      tags: [Search]
      summary: Trending artifacts
      description: Returns the most downloaded artifacts over a given time window.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: days
          in: query
          description: Number of days to look back for trending calculation.
          schema:
            type: integer
            default: 7
            minimum: 1
            maximum: 90
      responses:
        "200":
          description: Trending artifacts
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Artifact"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/search/recent:
    get:
      operationId: getRecentArtifacts
      tags: [Search]
      summary: Recently uploaded artifacts
      description: Returns the most recently uploaded artifacts across all accessible repositories.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: limit
          in: query
          description: Maximum number of results to return.
          schema:
            type: integer
            default: 10
            minimum: 1
            maximum: 100
      responses:
        "200":
          description: Recent artifacts
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Artifact"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalServerError"

  # =============================================================================
  # Groups Endpoints
  # =============================================================================

  /api/v1/groups:
    get:
      operationId: listGroups
      tags: [Groups]
      summary: List groups
      description: Returns all groups visible to the authenticated user.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        "200":
          description: List of groups
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Group"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalServerError"

    post:
      operationId: createGroup
      tags: [Groups]
      summary: Create group
      description: Creates a new group. Requires admin privileges.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [name]
              properties:
                name:
                  type: string
                  minLength: 1
                  maxLength: 128
                  example: backend-team
                description:
                  type: string
                  maxLength: 512
      responses:
        "201":
          description: Group created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Group"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "409":
          $ref: "#/components/responses/Conflict"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/groups/{id}:
    get:
      operationId: getGroup
      tags: [Groups]
      summary: Get group
      description: Returns a single group by its unique identifier, including its members.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Group UUID
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Group details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Group"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

    patch:
      operationId: updateGroup
      tags: [Groups]
      summary: Update group
      description: Partially updates group metadata. Requires admin privileges.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Group UUID
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  minLength: 1
                  maxLength: 128
                description:
                  type: string
                  maxLength: 512
      responses:
        "200":
          description: Group updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Group"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          $ref: "#/components/responses/Conflict"
        "500":
          $ref: "#/components/responses/InternalServerError"

    delete:
      operationId: deleteGroup
      tags: [Groups]
      summary: Delete group
      description: Permanently deletes a group and removes all associated permission grants. Requires admin privileges.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Group UUID
          schema:
            type: string
            format: uuid
      responses:
        "204":
          description: Group deleted
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/groups/{id}/members:
    post:
      operationId: addGroupMembers
      tags: [Groups]
      summary: Add members to group
      description: Adds one or more users to the group. Users who are already members are silently ignored.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Group UUID
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [user_ids]
              properties:
                user_ids:
                  type: array
                  items:
                    type: string
                    format: uuid
                  minItems: 1
      responses:
        "204":
          description: Members added
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

    delete:
      operationId: removeGroupMembers
      tags: [Groups]
      summary: Remove members from group
      description: Removes one or more users from the group. Users who are not members are silently ignored.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Group UUID
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [user_ids]
              properties:
                user_ids:
                  type: array
                  items:
                    type: string
                    format: uuid
                  minItems: 1
      responses:
        "204":
          description: Members removed
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  # =============================================================================
  # Permissions Endpoints
  # =============================================================================

  /api/v1/permissions:
    get:
      operationId: listPermissions
      tags: [Permissions]
      summary: List permissions
      description: Returns all permission grants. Requires admin privileges.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        "200":
          description: List of permissions
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Permission"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "500":
          $ref: "#/components/responses/InternalServerError"

    post:
      operationId: createPermission
      tags: [Permissions]
      summary: Create permission
      description: >-
        Creates a new permission grant associating a principal (user or group)
        with allowed actions on a resource. Requires admin privileges.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [name, resource_type, actions, principal_type, principal_id]
              properties:
                name:
                  type: string
                  minLength: 1
                  maxLength: 128
                  example: backend-team-libs-release
                resource_type:
                  type: string
                  enum: [repository, global]
                  example: repository
                resource_id:
                  type: string
                  format: uuid
                  description: The resource to grant access to. Required when resource_type is not global.
                  nullable: true
                actions:
                  type: array
                  items:
                    type: string
                    enum: [read, write, delete, admin]
                  minItems: 1
                  example: [read, write]
                principal_type:
                  type: string
                  enum: [user, group]
                  example: group
                principal_id:
                  type: string
                  format: uuid
      responses:
        "201":
          description: Permission created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Permission"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "409":
          $ref: "#/components/responses/Conflict"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /api/v1/permissions/{id}:
    get:
      operationId: getPermission
      tags: [Permissions]
      summary: Get permission
      description: Returns a single permission grant by its unique identifier.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Permission UUID
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Permission details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Permission"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

    patch:
      operationId: updatePermission
      tags: [Permissions]
      summary: Update permission
      description: Updates the allowed actions on an existing permission grant. Requires admin privileges.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Permission UUID
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                actions:
                  type: array
                  items:
                    type: string
                    enum: [read, write, delete, admin]
                  minItems: 1
      responses:
        "200":
          description: Permission updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Permission"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

    delete:
      operationId: deletePermission
      tags: [Permissions]
      summary: Delete permission
      description: Permanently removes a permission grant. Requires admin privileges.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Permission UUID
          schema:
            type: string
            format: uuid
      responses:
        "204":
          description: Permission deleted
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"


  /api/v1/webhooks:
    get:
      operationId: listWebhooks
      tags: [Webhooks]
      summary: List webhooks
      description: Returns a paginated list of webhooks, optionally filtered by repository or enabled state.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: repository_id
          in: query
          description: Filter webhooks by repository ID.
          schema:
            type: string
            format: uuid
        - name: enabled
          in: query
          description: Filter by enabled state.
          schema:
            type: boolean
        - $ref: "#/components/parameters/page"
        - $ref: "#/components/parameters/perPage"
      responses:
        "200":
          description: Paginated list of webhooks.
          content:
            application/json:
              schema:
                type: object
                required: [items, pagination]
                properties:
                  items:
                    type: array
                    items:
                      $ref: "#/components/schemas/Webhook"
                  pagination:
                    $ref: "#/components/schemas/Pagination"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"

    post:
      operationId: createWebhook
      tags: [Webhooks]
      summary: Create a webhook
      description: Registers a new webhook endpoint that will receive event deliveries.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [url, events]
              properties:
                url:
                  type: string
                  format: uri
                  description: The URL that will receive webhook payloads.
                events:
                  type: array
                  items:
                    type: string
                  description: List of event types to subscribe to.
                repository_id:
                  type: string
                  format: uuid
                  description: Optional repository scope for the webhook.
                secret:
                  type: string
                  description: Optional shared secret used to sign payloads.
                is_enabled:
                  type: boolean
                  description: Whether the webhook is enabled on creation. Defaults to true.
      responses:
        "201":
          description: Webhook created.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Webhook"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "422":
          $ref: "#/components/responses/UnprocessableEntity"

  /api/v1/webhooks/{id}:
    parameters:
      - name: id
        in: path
        required: true
        description: Webhook ID.
        schema:
          type: string
          format: uuid

    get:
      operationId: getWebhook
      tags: [Webhooks]
      summary: Get a webhook
      description: Returns the details of a single webhook by ID.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        "200":
          description: Webhook details.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Webhook"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

    delete:
      operationId: deleteWebhook
      tags: [Webhooks]
      summary: Delete a webhook
      description: Permanently removes a webhook and all its delivery history.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        "204":
          description: Webhook deleted.
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/webhooks/{id}/enable:
    parameters:
      - name: id
        in: path
        required: true
        description: Webhook ID.
        schema:
          type: string
          format: uuid
    post:
      operationId: enableWebhook
      tags: [Webhooks]
      summary: Enable a webhook
      description: Activates a previously disabled webhook so it resumes receiving deliveries.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        "200":
          description: Webhook enabled.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Webhook"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/webhooks/{id}/disable:
    parameters:
      - name: id
        in: path
        required: true
        description: Webhook ID.
        schema:
          type: string
          format: uuid
    post:
      operationId: disableWebhook
      tags: [Webhooks]
      summary: Disable a webhook
      description: Suspends a webhook so it no longer receives deliveries until re-enabled.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        "200":
          description: Webhook disabled.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Webhook"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/webhooks/{id}/test:
    parameters:
      - name: id
        in: path
        required: true
        description: Webhook ID.
        schema:
          type: string
          format: uuid
    post:
      operationId: testWebhook
      tags: [Webhooks]
      summary: Send a test delivery
      description: Sends a synthetic test payload to the webhook URL and returns the delivery result.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        "200":
          description: Test delivery result.
          content:
            application/json:
              schema:
                type: object
                required: [delivery_id, status_code, response_body]
                properties:
                  delivery_id:
                    type: string
                    format: uuid
                  status_code:
                    type: integer
                  response_body:
                    type: string
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/webhooks/{id}/deliveries:
    parameters:
      - name: id
        in: path
        required: true
        description: Webhook ID.
        schema:
          type: string
          format: uuid
    get:
      operationId: listWebhookDeliveries
      tags: [Webhooks]
      summary: List webhook deliveries
      description: Returns a paginated history of delivery attempts for a webhook.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - $ref: "#/components/parameters/page"
        - $ref: "#/components/parameters/perPage"
      responses:
        "200":
          description: Paginated list of deliveries.
          content:
            application/json:
              schema:
                type: object
                required: [items, pagination]
                properties:
                  items:
                    type: array
                    items:
                      $ref: "#/components/schemas/WebhookDelivery"
                  pagination:
                    $ref: "#/components/schemas/Pagination"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/webhooks/{id}/deliveries/{deliveryId}/redeliver:
    parameters:
      - name: id
        in: path
        required: true
        description: Webhook ID.
        schema:
          type: string
          format: uuid
      - name: deliveryId
        in: path
        required: true
        description: Delivery ID to redeliver.
        schema:
          type: string
          format: uuid
    post:
      operationId: redeliverWebhookDelivery
      tags: [Webhooks]
      summary: Redeliver a webhook payload
      description: Retries a previous delivery, sending the same payload to the webhook URL again.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        "200":
          description: Redelivery result.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/WebhookDelivery"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  # 
  # 10. Plugins
  # 
  /api/v1/plugins:
    get:
      operationId: listPlugins
      tags: [Plugins]
      summary: List plugins
      description: Returns a paginated list of installed plugins, optionally filtered by status or type.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: status
          in: query
          description: Filter plugins by status (e.g. active, disabled, error).
          schema:
            type: string
        - name: type
          in: query
          description: Filter plugins by type (e.g. scanner, format, hook).
          schema:
            type: string
        - $ref: "#/components/parameters/page"
        - $ref: "#/components/parameters/perPage"
      responses:
        "200":
          description: Paginated list of plugins.
          content:
            application/json:
              schema:
                type: object
                required: [items, pagination]
                properties:
                  items:
                    type: array
                    items:
                      $ref: "#/components/schemas/Plugin"
                  pagination:
                    $ref: "#/components/schemas/Pagination"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"

    post:
      operationId: uploadPlugin
      tags: [Plugins]
      summary: Upload a plugin
      description: Uploads and installs a plugin from a multipart form submission containing the WASM binary and metadata.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required: [file]
              properties:
                file:
                  type: string
                  format: binary
                  description: The plugin WASM binary.
                name:
                  type: string
                  description: Human-readable plugin name.
                description:
                  type: string
                  description: Plugin description.
      responses:
        "201":
          description: Plugin installed.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Plugin"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "422":
          $ref: "#/components/responses/UnprocessableEntity"

  /api/v1/plugins/{id}:
    parameters:
      - name: id
        in: path
        required: true
        description: Plugin ID.
        schema:
          type: string
          format: uuid

    get:
      operationId: getPlugin
      tags: [Plugins]
      summary: Get a plugin
      description: Returns details of a single installed plugin.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        "200":
          description: Plugin details.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Plugin"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

    delete:
      operationId: deletePlugin
      tags: [Plugins]
      summary: Delete a plugin
      description: Uninstalls and removes a plugin and its stored configuration.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        "204":
          description: Plugin deleted.
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/plugins/{id}/enable:
    parameters:
      - name: id
        in: path
        required: true
        description: Plugin ID.
        schema:
          type: string
          format: uuid
    post:
      operationId: enablePlugin
      tags: [Plugins]
      summary: Enable a plugin
      description: Activates a disabled plugin so it begins processing events.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        "200":
          description: Plugin enabled.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Plugin"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/plugins/{id}/disable:
    parameters:
      - name: id
        in: path
        required: true
        description: Plugin ID.
        schema:
          type: string
          format: uuid
    post:
      operationId: disablePlugin
      tags: [Plugins]
      summary: Disable a plugin
      description: Deactivates a plugin so it stops processing events until re-enabled.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        "200":
          description: Plugin disabled.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Plugin"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/plugins/{id}/config:
    parameters:
      - name: id
        in: path
        required: true
        description: Plugin ID.
        schema:
          type: string
          format: uuid

    get:
      operationId: getPluginConfig
      tags: [Plugins]
      summary: Get plugin configuration
      description: Returns the current configuration object for a plugin.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        "200":
          description: Plugin configuration.
          content:
            application/json:
              schema:
                type: object
                additionalProperties: true
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

    post:
      operationId: updatePluginConfig
      tags: [Plugins]
      summary: Update plugin configuration
      description: Replaces the configuration object for a plugin.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              additionalProperties: true
      responses:
        "200":
          description: Updated configuration.
          content:
            application/json:
              schema:
                type: object
                additionalProperties: true
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/plugins/{id}/events:
    parameters:
      - name: id
        in: path
        required: true
        description: Plugin ID.
        schema:
          type: string
          format: uuid
    get:
      operationId: listPluginEvents
      tags: [Plugins]
      summary: List plugin events
      description: Returns a paginated log of events processed or emitted by a plugin.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - $ref: "#/components/parameters/page"
        - $ref: "#/components/parameters/perPage"
      responses:
        "200":
          description: Paginated list of plugin events.
          content:
            application/json:
              schema:
                type: object
                required: [items, pagination]
                properties:
                  items:
                    type: array
                    items:
                      $ref: "#/components/schemas/PluginEvent"
                  pagination:
                    $ref: "#/components/schemas/Pagination"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/plugins/install/git:
    post:
      operationId: installPluginFromGit
      tags: [Plugins]
      summary: Install a plugin from a Git repository
      description: Clones a Git repository, builds the plugin, and installs it.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [url]
              properties:
                url:
                  type: string
                  format: uri
                  description: Git repository URL.
                ref:
                  type: string
                  description: Optional Git ref (branch, tag, or commit SHA).
      responses:
        "201":
          description: Plugin installed from Git.
          content:
            application/json:
              schema:
                type: object
                required: [plugin, message]
                properties:
                  plugin:
                    $ref: "#/components/schemas/Plugin"
                  message:
                    type: string
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "422":
          $ref: "#/components/responses/UnprocessableEntity"

  /api/v1/plugins/install/zip:
    post:
      operationId: installPluginFromZip
      tags: [Plugins]
      summary: Install a plugin from a ZIP archive
      description: Accepts a ZIP file upload containing the plugin source or binary and installs it.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required: [file]
              properties:
                file:
                  type: string
                  format: binary
                  description: ZIP archive containing the plugin.
      responses:
        "201":
          description: Plugin installed from ZIP.
          content:
            application/json:
              schema:
                type: object
                required: [plugin, message]
                properties:
                  plugin:
                    $ref: "#/components/schemas/Plugin"
                  message:
                    type: string
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "422":
          $ref: "#/components/responses/UnprocessableEntity"

  /api/v1/plugins/install/local:
    post:
      operationId: installPluginFromLocal
      tags: [Plugins]
      summary: Install a plugin from a local path
      description: Installs a plugin from a directory on the server filesystem.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [path]
              properties:
                path:
                  type: string
                  description: Absolute path on the server to the plugin directory.
      responses:
        "201":
          description: Plugin installed from local path.
          content:
            application/json:
              schema:
                type: object
                required: [plugin, message]
                properties:
                  plugin:
                    $ref: "#/components/schemas/Plugin"
                  message:
                    type: string
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "422":
          $ref: "#/components/responses/UnprocessableEntity"

  /api/v1/plugins/{id}/reload:
    parameters:
      - name: id
        in: path
        required: true
        description: Plugin ID.
        schema:
          type: string
          format: uuid
    post:
      operationId: reloadPlugin
      tags: [Plugins]
      summary: Reload a plugin
      description: Hot-reloads a plugin, re-reading its WASM binary and configuration without a full restart.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        "200":
          description: Plugin reloaded.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Plugin"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  # 
  # 11. Formats
  # 
  /api/v1/formats:
    get:
      operationId: listFormats
      tags: [Formats]
      summary: List format handlers
      description: Returns all registered artifact format handlers, optionally filtered by type or enabled state.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: type
          in: query
          description: Filter by format type (e.g. maven, npm, pypi).
          schema:
            type: string
        - name: enabled
          in: query
          description: Filter by enabled state.
          schema:
            type: boolean
      responses:
        "200":
          description: List of format handlers.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/FormatHandler"
        "401":
          $ref: "#/components/responses/Unauthorized"

  /api/v1/formats/{formatKey}:
    parameters:
      - name: formatKey
        in: path
        required: true
        description: Unique key identifying the format (e.g. maven, npm, pypi).
        schema:
          type: string

    get:
      operationId: getFormat
      tags: [Formats]
      summary: Get a format handler
      description: Returns details of a single format handler by its key.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        "200":
          description: Format handler details.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/FormatHandler"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/formats/{formatKey}/enable:
    parameters:
      - name: formatKey
        in: path
        required: true
        description: Format key.
        schema:
          type: string
    post:
      operationId: enableFormat
      tags: [Formats]
      summary: Enable a format handler
      description: Enables a format handler so its repositories can accept uploads and serve downloads.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        "200":
          description: Format handler enabled.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/FormatHandler"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/formats/{formatKey}/disable:
    parameters:
      - name: formatKey
        in: path
        required: true
        description: Format key.
        schema:
          type: string
    post:
      operationId: disableFormat
      tags: [Formats]
      summary: Disable a format handler
      description: Disables a format handler, preventing uploads and downloads for that format.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        "200":
          description: Format handler disabled.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/FormatHandler"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/formats/{formatKey}/test:
    parameters:
      - name: formatKey
        in: path
        required: true
        description: Format key.
        schema:
          type: string
    post:
      operationId: testFormat
      tags: [Formats]
      summary: Test format validation
      description: Validates a sample artifact against the format handler and returns parsed metadata or errors.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [path, content_base64]
              properties:
                path:
                  type: string
                  description: Simulated file path for the artifact.
                content_base64:
                  type: string
                  description: Base64-encoded artifact content to validate.
      responses:
        "200":
          description: Validation result.
          content:
            application/json:
              schema:
                type: object
                required: [valid]
                properties:
                  valid:
                    type: boolean
                  metadata:
                    type: object
                    additionalProperties: true
                  error:
                    type: string
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  # 
  # 12. Signing
  # 
  /api/v1/signing/keys:
    get:
      operationId: listSigningKeys
      tags: [Signing]
      summary: List signing keys
      description: Returns all signing keys, optionally scoped to a repository.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: repository_id
          in: query
          description: Filter keys by repository ID.
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: List of signing keys.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/SigningKey"
        "401":
          $ref: "#/components/responses/Unauthorized"

    post:
      operationId: createSigningKey
      tags: [Signing]
      summary: Create a signing key
      description: Generates a new signing key pair of the specified type and size.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [name, key_type]
              properties:
                name:
                  type: string
                  description: Human-readable name for the key.
                key_type:
                  type: string
                  enum: [rsa, gpg]
                  description: Cryptographic key type.
                repository_id:
                  type: string
                  format: uuid
                  description: Optional repository to scope this key to.
                key_size:
                  type: integer
                  description: Key size in bits (e.g. 2048, 4096).
      responses:
        "201":
          description: Signing key created.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SigningKey"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "422":
          $ref: "#/components/responses/UnprocessableEntity"

  /api/v1/signing/keys/{keyId}:
    parameters:
      - name: keyId
        in: path
        required: true
        description: Signing key ID.
        schema:
          type: string
          format: uuid

    get:
      operationId: getSigningKey
      tags: [Signing]
      summary: Get a signing key
      description: Returns details of a single signing key.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        "200":
          description: Signing key details.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SigningKey"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

    delete:
      operationId: deleteSigningKey
      tags: [Signing]
      summary: Delete a signing key
      description: Permanently removes a signing key. Active repositories using this key must be reconfigured first.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        "204":
          description: Signing key deleted.
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          $ref: "#/components/responses/Conflict"

  /api/v1/signing/keys/{keyId}/revoke:
    parameters:
      - name: keyId
        in: path
        required: true
        description: Signing key ID.
        schema:
          type: string
          format: uuid
    post:
      operationId: revokeSigningKey
      tags: [Signing]
      summary: Revoke a signing key
      description: Marks a signing key as revoked so it can no longer be used for signing operations.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        "200":
          description: Signing key revoked.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SigningKey"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/signing/keys/{keyId}/rotate:
    parameters:
      - name: keyId
        in: path
        required: true
        description: Signing key ID.
        schema:
          type: string
          format: uuid
    post:
      operationId: rotateSigningKey
      tags: [Signing]
      summary: Rotate a signing key
      description: Generates a new key pair, replaces the existing key, and revokes the old one.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        "200":
          description: Signing key rotated.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SigningKey"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/signing/keys/{keyId}/public:
    parameters:
      - name: keyId
        in: path
        required: true
        description: Signing key ID.
        schema:
          type: string
          format: uuid
    get:
      operationId: getSigningKeyPublic
      tags: [Signing]
      summary: Get public key material
      description: Returns the public key in PEM (RSA) or ASCII-armored (GPG) format.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        "200":
          description: Public key in text format.
          content:
            text/plain:
              schema:
                type: string
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/signing/repositories/{repoId}/config:
    parameters:
      - name: repoId
        in: path
        required: true
        description: Repository ID.
        schema:
          type: string
          format: uuid

    get:
      operationId: getRepositorySigningConfig
      tags: [Signing]
      summary: Get repository signing configuration
      description: Returns the signing configuration for a repository.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        "200":
          description: Signing configuration.
          content:
            application/json:
              schema:
                type: object
                properties:
                  enabled:
                    type: boolean
                  key_id:
                    type: string
                    format: uuid
                  sign_metadata:
                    type: boolean
                  sign_packages:
                    type: boolean
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

    post:
      operationId: updateRepositorySigningConfig
      tags: [Signing]
      summary: Update repository signing configuration
      description: Updates signing settings for a repository, such as which key to use and what to sign.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                enabled:
                  type: boolean
                key_id:
                  type: string
                  format: uuid
                sign_metadata:
                  type: boolean
                sign_packages:
                  type: boolean
      responses:
        "200":
          description: Updated signing configuration.
          content:
            application/json:
              schema:
                type: object
                additionalProperties: true
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/signing/repositories/{repoId}/public-key:
    parameters:
      - name: repoId
        in: path
        required: true
        description: Repository ID.
        schema:
          type: string
          format: uuid
    get:
      operationId: getRepositoryPublicKey
      tags: [Signing]
      summary: Get repository public key
      description: Returns the active public signing key for a repository in PEM or GPG armored format.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        "200":
          description: Public key in text format.
          content:
            text/plain:
              schema:
                type: string
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  # 
  # 13. Security
  # 
  /api/v1/security/dashboard:
    get:
      operationId: getSecurityDashboard
      tags: [Security]
      summary: Get security dashboard
      description: Returns an overview of security scan statistics and overall health score.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        "200":
          description: Security dashboard summary.
          content:
            application/json:
              schema:
                type: object
                required: [total_scans, critical_findings, high_findings, repositories_scanned, overall_score]
                properties:
                  total_scans:
                    type: integer
                  critical_findings:
                    type: integer
                  high_findings:
                    type: integer
                  repositories_scanned:
                    type: integer
                  overall_score:
                    type: number
                    format: float
        "401":
          $ref: "#/components/responses/Unauthorized"

  /api/v1/security/scores:
    get:
      operationId: listSecurityScores
      tags: [Security]
      summary: List security scores
      description: Returns security scores for all scanned repositories.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        "200":
          description: List of security scores.
          content:
            application/json:
              schema:
                type: object
                required: [items]
                properties:
                  items:
                    type: array
                    items:
                      $ref: "#/components/schemas/SecurityScore"
        "401":
          $ref: "#/components/responses/Unauthorized"

  /api/v1/security/scan:
    post:
      operationId: triggerSecurityScan
      tags: [Security]
      summary: Trigger a security scan
      description: Initiates an asynchronous security scan for a specific artifact, repository, or using a named scanner.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                artifact_id:
                  type: string
                  format: uuid
                  description: Scan a specific artifact.
                repository_id:
                  type: string
                  format: uuid
                  description: Scan all artifacts in a repository.
                scanner:
                  type: string
                  description: Name of the scanner plugin to use.
      responses:
        "202":
          description: Scan initiated.
          content:
            application/json:
              schema:
                type: object
                required: [scan_id]
                properties:
                  scan_id:
                    type: string
                    format: uuid
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "422":
          $ref: "#/components/responses/UnprocessableEntity"

  /api/v1/security/scans:
    get:
      operationId: listSecurityScans
      tags: [Security]
      summary: List security scans
      description: Returns a paginated list of security scans, optionally filtered by status or repository.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: status
          in: query
          description: Filter by scan status (e.g. pending, running, completed, failed).
          schema:
            type: string
        - name: repository_id
          in: query
          description: Filter scans by repository ID.
          schema:
            type: string
            format: uuid
        - $ref: "#/components/parameters/page"
        - $ref: "#/components/parameters/perPage"
      responses:
        "200":
          description: Paginated list of scans.
          content:
            application/json:
              schema:
                type: object
                required: [items, pagination]
                properties:
                  items:
                    type: array
                    items:
                      $ref: "#/components/schemas/Scan"
                  pagination:
                    $ref: "#/components/schemas/Pagination"
        "401":
          $ref: "#/components/responses/Unauthorized"

  /api/v1/security/scans/{id}:
    parameters:
      - name: id
        in: path
        required: true
        description: Scan ID.
        schema:
          type: string
          format: uuid
    get:
      operationId: getSecurityScan
      tags: [Security]
      summary: Get a security scan
      description: Returns the details and current status of a single security scan.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        "200":
          description: Scan details.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Scan"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/security/scans/{id}/findings:
    parameters:
      - name: id
        in: path
        required: true
        description: Scan ID.
        schema:
          type: string
          format: uuid
    get:
      operationId: listScanFindings
      tags: [Security]
      summary: List scan findings
      description: Returns a paginated list of vulnerability findings from a security scan, optionally filtered by severity.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: severity
          in: query
          description: Filter findings by severity (e.g. critical, high, medium, low).
          schema:
            type: string
        - $ref: "#/components/parameters/page"
        - $ref: "#/components/parameters/perPage"
      responses:
        "200":
          description: Paginated list of findings.
          content:
            application/json:
              schema:
                type: object
                required: [items, pagination]
                properties:
                  items:
                    type: array
                    items:
                      $ref: "#/components/schemas/Finding"
                  pagination:
                    $ref: "#/components/schemas/Pagination"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/security/artifacts/{artifactId}/scans:
    parameters:
      - name: artifactId
        in: path
        required: true
        description: Artifact ID.
        schema:
          type: string
          format: uuid
    get:
      operationId: listArtifactScans
      tags: [Security]
      summary: List scans for an artifact
      description: Returns all security scans that have been performed on a specific artifact.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        "200":
          description: List of scans for the artifact.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Scan"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/security/findings/{id}/acknowledge:
    parameters:
      - name: id
        in: path
        required: true
        description: Finding ID.
        schema:
          type: string
          format: uuid

    post:
      operationId: acknowledgeFinding
      tags: [Security]
      summary: Acknowledge a finding
      description: Marks a security finding as acknowledged with a reason, suppressing it from active alerts.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [reason]
              properties:
                reason:
                  type: string
                  description: Justification for acknowledging the finding.
      responses:
        "200":
          description: Finding acknowledged.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Finding"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

    delete:
      operationId: unacknowledgeFinding
      tags: [Security]
      summary: Remove acknowledgement from a finding
      description: Removes the acknowledgement from a finding, restoring it to active status.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        "200":
          description: Finding acknowledgement removed.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Finding"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/security/policies:
    get:
      operationId: listSecurityPolicies
      tags: [Security]
      summary: List security policies
      description: Returns all configured security policies.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        "200":
          description: List of security policies.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/SecurityPolicy"
        "401":
          $ref: "#/components/responses/Unauthorized"

    post:
      operationId: createSecurityPolicy
      tags: [Security]
      summary: Create a security policy
      description: Creates a new security policy with the specified rules and optional repository scope.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [name, rules]
              properties:
                name:
                  type: string
                  description: Policy name.
                rules:
                  type: array
                  items:
                    type: object
                    additionalProperties: true
                  description: List of policy rules.
                repository_id:
                  type: string
                  format: uuid
                  description: Optional repository scope.
                enabled:
                  type: boolean
                  description: Whether the policy is active on creation. Defaults to true.
      responses:
        "201":
          description: Security policy created.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SecurityPolicy"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "422":
          $ref: "#/components/responses/UnprocessableEntity"

  /api/v1/security/policies/{id}:
    parameters:
      - name: id
        in: path
        required: true
        description: Security policy ID.
        schema:
          type: string
          format: uuid

    get:
      operationId: getSecurityPolicy
      tags: [Security]
      summary: Get a security policy
      description: Returns the details of a single security policy.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        "200":
          description: Security policy details.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SecurityPolicy"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

    put:
      operationId: updateSecurityPolicy
      tags: [Security]
      summary: Update a security policy
      description: Replaces a security policy with the provided definition.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SecurityPolicy"
      responses:
        "200":
          description: Security policy updated.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SecurityPolicy"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "422":
          $ref: "#/components/responses/UnprocessableEntity"

    delete:
      operationId: deleteSecurityPolicy
      tags: [Security]
      summary: Delete a security policy
      description: Permanently removes a security policy.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        "204":
          description: Security policy deleted.
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  # 
  # 14. Edge Nodes
  # 
  /api/v1/edge-nodes:
    get:
      operationId: listEdgeNodes
      tags: [Edge Nodes]
      summary: List edge nodes
      description: Returns all registered edge nodes in the distribution network.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        "200":
          description: List of edge nodes.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/EdgeNode"
        "401":
          $ref: "#/components/responses/Unauthorized"

    post:
      operationId: createEdgeNode
      tags: [Edge Nodes]
      summary: Register an edge node
      description: Registers a new edge node and returns its connection details including an API key for node-to-server authentication.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [name, region, url, capacity_mb]
              properties:
                name:
                  type: string
                  description: Display name for the node.
                region:
                  type: string
                  description: Geographic region identifier.
                url:
                  type: string
                  format: uri
                  description: Base URL where the node is reachable.
                capacity_mb:
                  type: integer
                  description: Cache capacity in megabytes.
      responses:
        "201":
          description: Edge node registered.
          content:
            application/json:
              schema:
                type: object
                required: [node, api_key]
                properties:
                  node:
                    $ref: "#/components/schemas/EdgeNode"
                  api_key:
                    type: string
                    description: API key for the node to authenticate with the server.
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "422":
          $ref: "#/components/responses/UnprocessableEntity"

  /api/v1/edge-nodes/{id}:
    parameters:
      - name: id
        in: path
        required: true
        description: Edge node ID.
        schema:
          type: string
          format: uuid

    get:
      operationId: getEdgeNode
      tags: [Edge Nodes]
      summary: Get an edge node
      description: Returns details of a single edge node including its status and configuration.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        "200":
          description: Edge node details.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/EdgeNode"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

    delete:
      operationId: deleteEdgeNode
      tags: [Edge Nodes]
      summary: Deregister an edge node
      description: Removes an edge node from the network and invalidates its API key.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        "204":
          description: Edge node deleted.
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/edge-nodes/{id}/heartbeat:
    parameters:
      - name: id
        in: path
        required: true
        description: Edge node ID.
        schema:
          type: string
          format: uuid
    post:
      operationId: edgeNodeHeartbeat
      tags: [Edge Nodes]
      summary: Send a heartbeat
      description: Reports current status and cache usage from an edge node to the coordinator.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [cache_size_mb, status]
              properties:
                cache_size_mb:
                  type: integer
                  description: Current cache usage in megabytes.
                status:
                  type: string
                  description: Current node status (e.g. healthy, degraded).
      responses:
        "200":
          description: Heartbeat accepted.
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/edge-nodes/{id}/sync:
    parameters:
      - name: id
        in: path
        required: true
        description: Edge node ID.
        schema:
          type: string
          format: uuid
    post:
      operationId: triggerEdgeNodeSync
      tags: [Edge Nodes]
      summary: Trigger sync
      description: Initiates a synchronization task to bring the edge node cache up to date.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        "200":
          description: Sync task initiated.
          content:
            application/json:
              schema:
                type: object
                required: [task_id]
                properties:
                  task_id:
                    type: string
                    format: uuid
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/edge-nodes/{id}/sync/tasks:
    parameters:
      - name: id
        in: path
        required: true
        description: Edge node ID.
        schema:
          type: string
          format: uuid
    get:
      operationId: listEdgeNodeSyncTasks
      tags: [Edge Nodes]
      summary: List sync tasks
      description: Returns all synchronization tasks for an edge node.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        "200":
          description: List of sync tasks.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/SyncTask"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/edge-nodes/{id}/repositories/{repoId}:
    parameters:
      - name: id
        in: path
        required: true
        description: Edge node ID.
        schema:
          type: string
          format: uuid
      - name: repoId
        in: path
        required: true
        description: Repository ID.
        schema:
          type: string
          format: uuid

    post:
      operationId: assignRepositoryToEdgeNode
      tags: [Edge Nodes]
      summary: Assign a repository to an edge node
      description: Configures an edge node to cache and serve artifacts from the specified repository.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [priority]
              properties:
                priority:
                  type: integer
                  description: Sync priority for this repository on the node.
      responses:
        "201":
          description: Repository assigned to edge node.
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

    delete:
      operationId: removeRepositoryFromEdgeNode
      tags: [Edge Nodes]
      summary: Remove a repository from an edge node
      description: Stops the edge node from caching the specified repository and purges its cached artifacts.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        "204":
          description: Repository removed from edge node.
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/edge-nodes/{id}/transfer/init:
    parameters:
      - name: id
        in: path
        required: true
        description: Edge node ID.
        schema:
          type: string
          format: uuid
    post:
      operationId: initTransferSession
      tags: [Edge Nodes]
      summary: Initiate a transfer session
      description: Creates a new chunked transfer session to distribute an artifact to or between edge nodes.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [artifact_id]
              properties:
                artifact_id:
                  type: string
                  format: uuid
                  description: Artifact to transfer.
                target_node_id:
                  type: string
                  format: uuid
                  description: Optional target edge node for node-to-node transfer.
      responses:
        "201":
          description: Transfer session created.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TransferSession"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/edge-nodes/{id}/transfer/{sessionId}:
    parameters:
      - name: id
        in: path
        required: true
        description: Edge node ID.
        schema:
          type: string
          format: uuid
      - name: sessionId
        in: path
        required: true
        description: Transfer session ID.
        schema:
          type: string
          format: uuid
    get:
      operationId: getTransferSession
      tags: [Edge Nodes]
      summary: Get transfer session status
      description: Returns the current status and progress of a transfer session.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        "200":
          description: Transfer session details.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TransferSession"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/edge-nodes/{id}/transfer/{sessionId}/chunks:
    parameters:
      - name: id
        in: path
        required: true
        description: Edge node ID.
        schema:
          type: string
          format: uuid
      - name: sessionId
        in: path
        required: true
        description: Transfer session ID.
        schema:
          type: string
          format: uuid
    get:
      operationId: getTransferChunkManifest
      tags: [Edge Nodes]
      summary: Get chunk manifest
      description: Returns the chunk manifest for a transfer session including sizes and checksums.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        "200":
          description: Chunk manifest.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ChunkManifest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/edge-nodes/{id}/transfer/{sessionId}/chunk/{chunkIndex}:
    parameters:
      - name: id
        in: path
        required: true
        description: Edge node ID.
        schema:
          type: string
          format: uuid
      - name: sessionId
        in: path
        required: true
        description: Transfer session ID.
        schema:
          type: string
          format: uuid
      - name: chunkIndex
        in: path
        required: true
        description: Zero-based chunk index.
        schema:
          type: integer
    post:
      operationId: uploadTransferChunk
      tags: [Edge Nodes]
      summary: Upload a transfer chunk
      description: Uploads a single binary chunk for a transfer session.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      requestBody:
        required: true
        content:
          application/octet-stream:
            schema:
              type: string
              format: binary
      responses:
        "200":
          description: Chunk uploaded.
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/edge-nodes/{id}/transfer/{sessionId}/chunk/{chunkIndex}/fail:
    parameters:
      - name: id
        in: path
        required: true
        description: Edge node ID.
        schema:
          type: string
          format: uuid
      - name: sessionId
        in: path
        required: true
        description: Transfer session ID.
        schema:
          type: string
          format: uuid
      - name: chunkIndex
        in: path
        required: true
        description: Zero-based chunk index.
        schema:
          type: integer
    post:
      operationId: failTransferChunk
      tags: [Edge Nodes]
      summary: Mark a chunk as failed
      description: Reports that a chunk transfer has failed, allowing the coordinator to take corrective action.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        "200":
          description: Chunk marked as failed.
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/edge-nodes/{id}/transfer/{sessionId}/chunk/{chunkIndex}/retry:
    parameters:
      - name: id
        in: path
        required: true
        description: Edge node ID.
        schema:
          type: string
          format: uuid
      - name: sessionId
        in: path
        required: true
        description: Transfer session ID.
        schema:
          type: string
          format: uuid
      - name: chunkIndex
        in: path
        required: true
        description: Zero-based chunk index.
        schema:
          type: integer
    post:
      operationId: retryTransferChunk
      tags: [Edge Nodes]
      summary: Retry a failed chunk
      description: Requests a retry of a previously failed chunk transfer.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        "200":
          description: Chunk retry initiated.
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/edge-nodes/{id}/transfer/{sessionId}/complete:
    parameters:
      - name: id
        in: path
        required: true
        description: Edge node ID.
        schema:
          type: string
          format: uuid
      - name: sessionId
        in: path
        required: true
        description: Transfer session ID.
        schema:
          type: string
          format: uuid
    post:
      operationId: completeTransferSession
      tags: [Edge Nodes]
      summary: Complete a transfer session
      description: Finalizes a transfer session after all chunks have been uploaded and verified.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        "200":
          description: Transfer session completed.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TransferSession"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/edge-nodes/{id}/transfer/{sessionId}/fail:
    parameters:
      - name: id
        in: path
        required: true
        description: Edge node ID.
        schema:
          type: string
          format: uuid
      - name: sessionId
        in: path
        required: true
        description: Transfer session ID.
        schema:
          type: string
          format: uuid
    post:
      operationId: failTransferSession
      tags: [Edge Nodes]
      summary: Fail a transfer session
      description: Marks an entire transfer session as failed, releasing resources.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        "200":
          description: Transfer session marked as failed.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TransferSession"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/edge-nodes/{id}/peers:
    parameters:
      - name: id
        in: path
        required: true
        description: Edge node ID.
        schema:
          type: string
          format: uuid
    get:
      operationId: listEdgeNodePeers
      tags: [Edge Nodes]
      summary: List known peers
      description: Returns the list of peer connections known to this edge node.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        "200":
          description: List of peer connections.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/PeerConnection"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/edge-nodes/{id}/peers/discover:
    parameters:
      - name: id
        in: path
        required: true
        description: Edge node ID.
        schema:
          type: string
          format: uuid
    get:
      operationId: discoverEdgeNodePeers
      tags: [Edge Nodes]
      summary: Discover peers
      description: Triggers peer discovery and returns newly found peer connections.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        "200":
          description: Discovered peer connections.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/PeerConnection"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/edge-nodes/{id}/peers/probe:
    parameters:
      - name: id
        in: path
        required: true
        description: Edge node ID.
        schema:
          type: string
          format: uuid
    post:
      operationId: probeEdgeNodePeers
      tags: [Edge Nodes]
      summary: Probe peer connectivity
      description: Tests network connectivity from this edge node to its peers and returns reachability and latency.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        "200":
          description: Probe result.
          content:
            application/json:
              schema:
                type: object
                required: [reachable, latency_ms]
                properties:
                  reachable:
                    type: boolean
                  latency_ms:
                    type: number
                    format: float
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/edge-nodes/{id}/peers/{targetId}/unreachable:
    parameters:
      - name: id
        in: path
        required: true
        description: Edge node ID.
        schema:
          type: string
          format: uuid
      - name: targetId
        in: path
        required: true
        description: Target peer node ID.
        schema:
          type: string
          format: uuid
    post:
      operationId: reportPeerUnreachable
      tags: [Edge Nodes]
      summary: Report a peer as unreachable
      description: Reports that a specific peer node is unreachable from this edge node, updating the network topology.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        "200":
          description: Peer marked as unreachable.
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/edge-nodes/{id}/chunks/{artifactId}:
    parameters:
      - name: id
        in: path
        required: true
        description: Edge node ID.
        schema:
          type: string
          format: uuid
      - name: artifactId
        in: path
        required: true
        description: Artifact ID.
        schema:
          type: string
          format: uuid
    get:
      operationId: listArtifactChunks
      tags: [Edge Nodes]
      summary: List artifact chunks on an edge node
      description: Returns the list of chunks for a specific artifact that are cached on this edge node.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        "200":
          description: List of chunks.
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  required:
                    - index
                    - offset
                    - size
                    - sha256
                    - status
                  properties:
                    index:
                      type: integer
                    offset:
                      type: integer
                    size:
                      type: integer
                    sha256:
                      type: string
                    status:
                      type: string
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/edge-nodes/{id}/chunks/{artifactId}/peers:
    parameters:
      - name: id
        in: path
        required: true
        description: Edge node ID.
        schema:
          type: string
          format: uuid
      - name: artifactId
        in: path
        required: true
        description: Artifact ID.
        schema:
          type: string
          format: uuid
    get:
      operationId: listArtifactChunkPeers
      tags: [Edge Nodes]
      summary: List peers holding artifact chunks
      description: Returns peers that have chunks of the specified artifact available for transfer.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        "200":
          description: List of peer connections holding artifact chunks.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/PeerConnection"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/edge-nodes/{id}/chunks/{artifactId}/scored-peers:
    parameters:
      - name: id
        in: path
        required: true
        description: Edge node ID.
        schema:
          type: string
          format: uuid
      - name: artifactId
        in: path
        required: true
        description: Artifact ID.
        schema:
          type: string
          format: uuid
    get:
      operationId: listArtifactScoredPeers
      tags: [Edge Nodes]
      summary: List scored peers for artifact chunks
      description: Returns peers holding artifact chunks ranked by a composite score of latency, bandwidth, and reliability.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        "200":
          description: Scored peer list.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/ScoredPeer"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/edge-nodes/network-profile:
    put:
      operationId: updateNetworkProfile
      tags: [Edge Nodes]
      summary: Update the network profile
      description: Replaces the global network profile that governs edge node communication parameters.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/NetworkProfile"
      responses:
        "200":
          description: Network profile updated.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/NetworkProfile"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "422":
          $ref: "#/components/responses/UnprocessableEntity"

  # 
  # 15. Admin
  # 
  /api/v1/admin/backups:
    get:
      operationId: listBackups
      tags: [Admin]
      summary: List backups
      description: Returns all backup records.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        "200":
          description: List of backups.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Backup"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"

    post:
      operationId: createBackup
      tags: [Admin]
      summary: Create a backup configuration
      description: Creates a new backup configuration specifying what to include.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [type]
              properties:
                type:
                  type: string
                  description: Backup type (e.g. full, metadata, config).
                include_artifacts:
                  type: boolean
                  description: Whether to include artifact binaries in the backup.
      responses:
        "201":
          description: Backup created.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Backup"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"

  /api/v1/admin/backups/{id}:
    parameters:
      - name: id
        in: path
        required: true
        description: Backup ID.
        schema:
          type: string
          format: uuid

    get:
      operationId: getBackup
      tags: [Admin]
      summary: Get a backup
      description: Returns details of a single backup including its status and metadata.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        "200":
          description: Backup details.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Backup"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"

    delete:
      operationId: deleteBackup
      tags: [Admin]
      summary: Delete a backup
      description: Permanently removes a backup and its stored data.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        "204":
          description: Backup deleted.
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/admin/backups/{id}/execute:
    parameters:
      - name: id
        in: path
        required: true
        description: Backup ID.
        schema:
          type: string
          format: uuid
    post:
      operationId: executeBackup
      tags: [Admin]
      summary: Execute a backup
      description: Starts the backup process asynchronously.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        "202":
          description: Backup execution started.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Backup"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/admin/backups/{id}/restore:
    parameters:
      - name: id
        in: path
        required: true
        description: Backup ID.
        schema:
          type: string
          format: uuid
    post:
      operationId: restoreBackup
      tags: [Admin]
      summary: Restore from a backup
      description: Starts an asynchronous restore operation from the specified backup.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        "202":
          description: Restore started.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Backup"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/admin/backups/{id}/cancel:
    parameters:
      - name: id
        in: path
        required: true
        description: Backup ID.
        schema:
          type: string
          format: uuid
    post:
      operationId: cancelBackup
      tags: [Admin]
      summary: Cancel a running backup or restore
      description: Cancels a backup or restore operation that is currently in progress.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        "200":
          description: Backup operation cancelled.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Backup"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/admin/settings:
    get:
      operationId: getSystemSettings
      tags: [Admin]
      summary: Get system settings
      description: Returns the current system-wide settings.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        "200":
          description: System settings.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SystemSettings"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"

    post:
      operationId: updateSystemSettings
      tags: [Admin]
      summary: Update system settings
      description: Replaces the system-wide settings with the provided values.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SystemSettings"
      responses:
        "200":
          description: Settings updated.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SystemSettings"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"

  /api/v1/admin/stats:
    get:
      operationId: getSystemStats
      tags: [Admin]
      summary: Get system statistics
      description: Returns aggregate system statistics including user, repository, and artifact counts.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        "200":
          description: System statistics.
          content:
            application/json:
              schema:
                type: object
                required: [users, repositories, artifacts, storage_used_bytes, total_downloads]
                properties:
                  users:
                    type: integer
                  repositories:
                    type: integer
                  artifacts:
                    type: integer
                  storage_used_bytes:
                    type: integer
                    format: int64
                  total_downloads:
                    type: integer
                    format: int64
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"

  /api/v1/admin/cleanup:
    post:
      operationId: triggerCleanup
      tags: [Admin]
      summary: Trigger storage cleanup
      description: Starts an asynchronous job to remove orphaned files and expired artifacts.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        "202":
          description: Cleanup job started.
          content:
            application/json:
              schema:
                type: object
                required: [job_id]
                properties:
                  job_id:
                    type: string
                    format: uuid
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"

  /api/v1/admin/reindex:
    post:
      operationId: triggerReindex
      tags: [Admin]
      summary: Trigger search reindex
      description: Starts an asynchronous job to rebuild the search index from stored metadata.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        "202":
          description: Reindex job started.
          content:
            application/json:
              schema:
                type: object
                required: [job_id]
                properties:
                  job_id:
                    type: string
                    format: uuid
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"

  # 
  # 16. Migration
  # 
  /api/v1/migrations/connections:
    get:
      operationId: listMigrationConnections
      tags: [Migration]
      summary: List migration connections
      description: Returns all configured source system connections for migrations.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        "200":
          description: List of migration connections.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/MigrationConnection"
        "401":
          $ref: "#/components/responses/Unauthorized"

    post:
      operationId: createMigrationConnection
      tags: [Migration]
      summary: Create a migration connection
      description: Registers a new source system connection for use in migration jobs.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [name, url, username, password_or_token, type]
              properties:
                name:
                  type: string
                  description: Display name for the connection.
                url:
                  type: string
                  format: uri
                  description: Base URL of the source system.
                username:
                  type: string
                  description: Authentication username.
                password_or_token:
                  type: string
                  description: Authentication password or API token.
                type:
                  type: string
                  description: Source system type (e.g. artifactory, nexus).
      responses:
        "201":
          description: Migration connection created.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MigrationConnection"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "422":
          $ref: "#/components/responses/UnprocessableEntity"

  /api/v1/migrations/connections/{id}:
    parameters:
      - name: id
        in: path
        required: true
        description: Migration connection ID.
        schema:
          type: string
          format: uuid

    get:
      operationId: getMigrationConnection
      tags: [Migration]
      summary: Get a migration connection
      description: Returns details of a single migration connection.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        "200":
          description: Migration connection details.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MigrationConnection"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

    delete:
      operationId: deleteMigrationConnection
      tags: [Migration]
      summary: Delete a migration connection
      description: Removes a migration connection. Active migrations using this connection must be stopped first.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        "204":
          description: Migration connection deleted.
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          $ref: "#/components/responses/Conflict"

  /api/v1/migrations/connections/{id}/test:
    parameters:
      - name: id
        in: path
        required: true
        description: Migration connection ID.
        schema:
          type: string
          format: uuid
    post:
      operationId: testMigrationConnection
      tags: [Migration]
      summary: Test a migration connection
      description: Validates connectivity and authentication against the source system.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        "200":
          description: Connection test result.
          content:
            application/json:
              schema:
                type: object
                required: [success, message]
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  version:
                    type: string
                    description: Detected version of the source system.
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/migrations/connections/{id}/repositories:
    parameters:
      - name: id
        in: path
        required: true
        description: Migration connection ID.
        schema:
          type: string
          format: uuid
    get:
      operationId: listRemoteRepositories
      tags: [Migration]
      summary: List remote repositories
      description: Discovers and returns repositories available on the source system.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        "200":
          description: Remote repositories.
          content:
            application/json:
              schema:
                type: object
                required: [repositories]
                properties:
                  repositories:
                    type: array
                    items:
                      $ref: "#/components/schemas/RemoteRepository"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/migrations:
    get:
      operationId: listMigrationJobs
      tags: [Migration]
      summary: List migration jobs
      description: Returns a paginated list of migration jobs, optionally filtered by status.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: status
          in: query
          description: Filter by migration status (e.g. pending, running, completed, failed).
          schema:
            type: string
        - $ref: "#/components/parameters/page"
        - $ref: "#/components/parameters/perPage"
      responses:
        "200":
          description: Paginated list of migration jobs.
          content:
            application/json:
              schema:
                type: object
                required: [items, pagination]
                properties:
                  items:
                    type: array
                    items:
                      $ref: "#/components/schemas/MigrationJob"
                  pagination:
                    $ref: "#/components/schemas/Pagination"
        "401":
          $ref: "#/components/responses/Unauthorized"

    post:
      operationId: createMigrationJob
      tags: [Migration]
      summary: Create a migration job
      description: Creates a new migration job to transfer artifacts from a source system.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [connection_id, source_repos, target_repos, options]
              properties:
                connection_id:
                  type: string
                  format: uuid
                  description: Source connection to migrate from.
                source_repos:
                  type: array
                  items:
                    type: string
                  description: List of source repository keys to migrate.
                target_repos:
                  type: array
                  items:
                    type: string
                  description: List of target repository keys to migrate into.
                options:
                  type: object
                  additionalProperties: true
                  description: Migration options (e.g. include_metadata, dry_run).
      responses:
        "201":
          description: Migration job created.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MigrationJob"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "422":
          $ref: "#/components/responses/UnprocessableEntity"

  /api/v1/migrations/{id}:
    parameters:
      - name: id
        in: path
        required: true
        description: Migration job ID.
        schema:
          type: string
          format: uuid

    get:
      operationId: getMigrationJob
      tags: [Migration]
      summary: Get a migration job
      description: Returns full details and progress of a migration job.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        "200":
          description: Migration job details.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MigrationJob"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

    delete:
      operationId: deleteMigrationJob
      tags: [Migration]
      summary: Delete a migration job
      description: Removes a completed or cancelled migration job and its records.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        "204":
          description: Migration job deleted.
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          $ref: "#/components/responses/Conflict"

  /api/v1/migrations/{id}/start:
    parameters:
      - name: id
        in: path
        required: true
        description: Migration job ID.
        schema:
          type: string
          format: uuid
    post:
      operationId: startMigrationJob
      tags: [Migration]
      summary: Start a migration job
      description: Begins executing a pending migration job asynchronously.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        "202":
          description: Migration started.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MigrationJob"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          $ref: "#/components/responses/Conflict"

  /api/v1/migrations/{id}/pause:
    parameters:
      - name: id
        in: path
        required: true
        description: Migration job ID.
        schema:
          type: string
          format: uuid
    post:
      operationId: pauseMigrationJob
      tags: [Migration]
      summary: Pause a migration job
      description: Pauses a running migration job so it can be resumed later.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        "200":
          description: Migration paused.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MigrationJob"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          $ref: "#/components/responses/Conflict"

  /api/v1/migrations/{id}/resume:
    parameters:
      - name: id
        in: path
        required: true
        description: Migration job ID.
        schema:
          type: string
          format: uuid
    post:
      operationId: resumeMigrationJob
      tags: [Migration]
      summary: Resume a migration job
      description: Resumes a paused migration job from where it left off.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        "200":
          description: Migration resumed.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MigrationJob"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          $ref: "#/components/responses/Conflict"

  /api/v1/migrations/{id}/cancel:
    parameters:
      - name: id
        in: path
        required: true
        description: Migration job ID.
        schema:
          type: string
          format: uuid
    post:
      operationId: cancelMigrationJob
      tags: [Migration]
      summary: Cancel a migration job
      description: Cancels a running or paused migration job. Already-migrated artifacts are retained.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        "200":
          description: Migration cancelled.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MigrationJob"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          $ref: "#/components/responses/Conflict"

  /api/v1/migrations/{id}/stream:
    parameters:
      - name: id
        in: path
        required: true
        description: Migration job ID.
        schema:
          type: string
          format: uuid
    get:
      operationId: streamMigrationProgress
      tags: [Migration]
      summary: Stream migration progress
      description: Opens a Server-Sent Events stream for real-time migration progress updates.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        "200":
          description: SSE event stream.
          content:
            text/event-stream:
              schema:
                type: string
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/migrations/{id}/items:
    parameters:
      - name: id
        in: path
        required: true
        description: Migration job ID.
        schema:
          type: string
          format: uuid
    get:
      operationId: listMigrationItems
      tags: [Migration]
      summary: List migration items
      description: Returns a paginated list of individual items in a migration job, optionally filtered by status.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: status
          in: query
          description: Filter items by status (e.g. pending, completed, failed, skipped).
          schema:
            type: string
        - $ref: "#/components/parameters/page"
        - $ref: "#/components/parameters/perPage"
      responses:
        "200":
          description: Paginated list of migration items.
          content:
            application/json:
              schema:
                type: object
                required: [items, pagination]
                properties:
                  items:
                    type: array
                    items:
                      $ref: "#/components/schemas/MigrationItem"
                  pagination:
                    $ref: "#/components/schemas/Pagination"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/migrations/{id}/report:
    parameters:
      - name: id
        in: path
        required: true
        description: Migration job ID.
        schema:
          type: string
          format: uuid
    get:
      operationId: getMigrationReport
      tags: [Migration]
      summary: Get migration report
      description: Returns a comprehensive report of a completed or in-progress migration job.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        "200":
          description: Migration report.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MigrationReport"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/migrations/{id}/assess:
    parameters:
      - name: id
        in: path
        required: true
        description: Migration job ID.
        schema:
          type: string
          format: uuid
    post:
      operationId: assessMigration
      tags: [Migration]
      summary: Assess a migration
      description: Triggers an asynchronous assessment of the migration to estimate size, duration, and potential issues.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        "202":
          description: Assessment started.
          content:
            application/json:
              schema:
                type: object
                required: [assessment_id]
                properties:
                  assessment_id:
                    type: string
                    format: uuid
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/migrations/{id}/assessment:
    parameters:
      - name: id
        in: path
        required: true
        description: Migration job ID.
        schema:
          type: string
          format: uuid
    get:
      operationId: getMigrationAssessment
      tags: [Migration]
      summary: Get migration assessment
      description: Returns the results of a previously triggered migration assessment.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        "200":
          description: Migration assessment.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MigrationAssessment"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  # 
  # 17. Builds, Packages, Tree
  # 
  /api/v1/builds:
    get:
      operationId: listBuilds
      tags: [Builds]
      summary: List builds
      description: Returns all recorded builds.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        "200":
          description: List of builds.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Build"
        "401":
          $ref: "#/components/responses/Unauthorized"

  /api/v1/builds/{id}:
    parameters:
      - name: id
        in: path
        required: true
        description: Build ID.
        schema:
          type: string
          format: uuid
    get:
      operationId: getBuild
      tags: [Builds]
      summary: Get a build
      description: Returns details of a single build including its artifacts and metadata.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        "200":
          description: Build details.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Build"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/builds/diff:
    get:
      operationId: diffBuilds
      tags: [Builds]
      summary: Compare two builds
      description: Returns a diff showing artifacts added, removed, or changed between two builds.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: build1
          in: query
          required: true
          description: First build ID.
          schema:
            type: string
            format: uuid
        - name: build2
          in: query
          required: true
          description: Second build ID.
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Build diff.
          content:
            application/json:
              schema:
                type: object
                required:
                  - build_a
                  - build_b
                  - added
                  - removed
                  - modified
                properties:
                  build_a:
                    type: string
                    format: uuid
                  build_b:
                    type: string
                    format: uuid
                  added:
                    type: array
                    items:
                      $ref: "#/components/schemas/Artifact"
                  removed:
                    type: array
                    items:
                      $ref: "#/components/schemas/Artifact"
                  modified:
                    type: array
                    items:
                      $ref: "#/components/schemas/Artifact"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/packages:
    get:
      operationId: listPackages
      tags: [Packages]
      summary: List packages
      description: Returns a paginated list of packages, optionally filtered by repository or search term.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      parameters:
        - name: repository_id
          in: query
          description: Filter packages by repository ID.
          schema:
            type: string
            format: uuid
        - name: search
          in: query
          description: Full-text search term.
          schema:
            type: string
        - $ref: "#/components/parameters/page"
        - $ref: "#/components/parameters/perPage"
      responses:
        "200":
          description: Paginated list of packages.
          content:
            application/json:
              schema:
                type: object
                required: [items, pagination]
                properties:
                  items:
                    type: array
                    items:
                      $ref: "#/components/schemas/Package"
                  pagination:
                    $ref: "#/components/schemas/Pagination"
        "401":
          $ref: "#/components/responses/Unauthorized"

  /api/v1/packages/{id}:
    parameters:
      - name: id
        in: path
        required: true
        description: Package ID.
        schema:
          type: string
          format: uuid
    get:
      operationId: getPackage
      tags: [Packages]
      summary: Get a package
      description: Returns details of a single package.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        "200":
          description: Package details.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Package"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/packages/{id}/versions:
    parameters:
      - name: id
        in: path
        required: true
        description: Package ID.
        schema:
          type: string
          format: uuid
    get:
      operationId: listPackageVersions
      tags: [Packages]
      summary: List package versions
      description: Returns all versions of a specific package.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        "200":
          description: List of package versions.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/PackageVersion"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/tree/{path}:
    parameters:
      - name: path
        in: path
        required: true
        description: Catch-all path representing the storage tree location.
        schema:
          type: string
    get:
      operationId: browseTree
      tags: [Tree]
      summary: Browse the storage tree
      description: Returns directory and file entries at the specified path in the virtual storage tree.
      security:
        - bearerAuth: []
        - apiKeyAuth: []
      responses:
        "200":
          description: Tree node listing.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/TreeNode"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"


components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
    apiKeyAuth:
      type: apiKey
      in: header
      name: X-API-Key

  parameters:
    page:
      name: page
      in: query
      description: Page number for pagination
      required: false
      schema:
        type: integer
        default: 1
        minimum: 1
    perPage:
      name: per_page
      in: query
      description: Number of items per page
      required: false
      schema:
        type: integer
        default: 20
        minimum: 1
        maximum: 100
  responses:
    BadRequest:
      description: Bad request
      content:
        application/json:
          schema:
            type: object
            required:
              - error
            properties:
              error:
                type: string
              details:
                type: object
    Unauthorized:
      description: Unauthorized
      content:
        application/json:
          schema:
            type: object
            required:
              - error
            properties:
              error:
                type: string
    Forbidden:
      description: Forbidden
      content:
        application/json:
          schema:
            type: object
            required:
              - error
            properties:
              error:
                type: string
    NotFound:
      description: Not found
      content:
        application/json:
          schema:
            type: object
            required:
              - error
            properties:
              error:
                type: string
    Conflict:
      description: Conflict
      content:
        application/json:
          schema:
            type: object
            required:
              - error
            properties:
              error:
                type: string
    UnprocessableEntity:
      description: Unprocessable entity
      content:
        application/json:
          schema:
            type: object
            required:
              - error
            properties:
              error:
                type: string
              details:
                type: object

    InternalServerError:
      description: Internal server error
      content:
        application/json:
          schema:
            type: object
            required:
              - error
            properties:
              error:
                type: string

  schemas:
    ComponentHealth:
      type: object
      required:
        - status
      properties:
        status:
          type: string
          enum:
            - healthy
            - degraded
            - unhealthy
        latency_ms:
          type:
            - integer
            - "null"
          description: Response time in milliseconds

    TokenPair:
      type: object
      required:
        - access_token
        - refresh_token
        - token_type
        - expires_in
      properties:
        access_token:
          type: string
        refresh_token:
          type: string
        token_type:
          type: string
          enum:
            - Bearer
        expires_in:
          type: integer
          description: Token lifetime in seconds

    Pagination:
      type: object
      required:
        - page
        - per_page
        - total_items
        - total_pages
      properties:
        page:
          type: integer
        per_page:
          type: integer
        total_items:
          type: integer
        total_pages:
          type: integer

    User:
      type: object
      required:
        - id
        - username
        - email
        - is_active
        - is_admin
        - created_at
        - updated_at
      properties:
        id:
          type: string
          format: uuid
        username:
          type: string
        email:
          type: string
        display_name:
          type:
            - string
            - "null"
        is_active:
          type: boolean
        is_admin:
          type: boolean
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    Role:
      type: object
      required:
        - id
        - name
        - permissions
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        description:
          type:
            - string
            - "null"
        permissions:
          type: array
          items:
            type: string

    ApiToken:
      type: object
      required:
        - id
        - name
        - created_at
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        scopes:
          type:
            - array
            - "null"
          items:
            type: string
        expires_at:
          type:
            - string
            - "null"
          format: date-time
        last_used_at:
          type:
            - string
            - "null"
          format: date-time
        created_at:
          type: string
          format: date-time

    Repository:
      type: object
      required:
        - id
        - key
        - name
        - format
        - type
        - is_public
        - used_bytes
        - artifact_count
        - created_at
        - updated_at
      properties:
        id:
          type: string
          format: uuid
        key:
          type: string
          description: Unique slug identifier
        name:
          type: string
        format:
          type: string
          enum:
            - maven
            - npm
            - pypi
            - nuget
            - cargo
            - go
            - docker
            - helm
            - debian
            - rpm
            - rubygems
            - conan
            - composer
            - alpine
            - conda
            - terraform
            - generic
        type:
          type: string
          enum:
            - local
            - remote
            - virtual
        description:
          type:
            - string
            - "null"
        is_public:
          type: boolean
        quota_bytes:
          type:
            - integer
            - "null"
        used_bytes:
          type: integer
        artifact_count:
          type: integer
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    Artifact:
      type: object
      required:
        - id
        - repository_id
        - repository_key
        - path
        - name
        - format
        - size_bytes
        - sha256
        - content_type
        - download_count
        - created_at
        - updated_at
      properties:
        id:
          type: string
          format: uuid
        repository_id:
          type: string
          format: uuid
        repository_key:
          type: string
        path:
          type: string
        name:
          type: string
        version:
          type:
            - string
            - "null"
        format:
          type: string
        size_bytes:
          type: integer
        sha256:
          type: string
        content_type:
          type: string
        download_count:
          type: integer
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    SearchResult:
      type: object
      required:
        - id
        - name
        - path
        - format
        - repository_key
        - size_bytes
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        path:
          type: string
        version:
          type:
            - string
            - "null"
        format:
          type: string
        repository_key:
          type: string
        size_bytes:
          type: integer
        highlight:
          type:
            - object
            - "null"
          description: Matched fields from the search query

    Group:
      type: object
      required:
        - id
        - name
        - member_count
        - created_at
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        description:
          type:
            - string
            - "null"
        member_count:
          type: integer
        created_at:
          type: string
          format: date-time

    Permission:
      type: object
      required:
        - id
        - name
        - resource_type
        - actions
        - principal_type
        - principal_id
        - created_at
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        resource_type:
          type: string
          enum:
            - repository
            - system
        resource_id:
          type:
            - string
            - "null"
          format: uuid
        actions:
          type: array
          items:
            type: string
            enum:
              - read
              - write
              - delete
              - admin
        principal_type:
          type: string
          enum:
            - user
            - group
        principal_id:
          type: string
          format: uuid
        created_at:
          type: string
          format: date-time

    Webhook:
      type: object
      required:
        - id
        - url
        - events
        - is_enabled
        - created_at
      properties:
        id:
          type: string
          format: uuid
        url:
          type: string
          format: uri
        events:
          type: array
          items:
            type: string
            enum:
              - artifact_uploaded
              - artifact_deleted
              - repository_created
              - repository_deleted
              - user_created
              - user_deleted
              - build_started
              - build_completed
              - build_failed
        repository_id:
          type:
            - string
            - "null"
          format: uuid
        is_enabled:
          type: boolean
        last_triggered_at:
          type:
            - string
            - "null"
          format: date-time
        created_at:
          type: string
          format: date-time

    WebhookDelivery:
      type: object
      required:
        - id
        - webhook_id
        - event
        - request_body
        - delivered_at
        - success
      properties:
        id:
          type: string
          format: uuid
        webhook_id:
          type: string
          format: uuid
        event:
          type: string
        status_code:
          type:
            - integer
            - "null"
        request_body:
          type: string
        response_body:
          type:
            - string
            - "null"
        delivered_at:
          type: string
          format: date-time
        success:
          type: boolean

    Plugin:
      type: object
      required:
        - id
        - name
        - version
        - status
        - source_type
        - installed_at
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        version:
          type: string
        description:
          type:
            - string
            - "null"
        author:
          type:
            - string
            - "null"
        license:
          type:
            - string
            - "null"
        status:
          type: string
          enum:
            - active
            - disabled
            - error
        source_type:
          type: string
          enum:
            - core
            - wasm_git
            - wasm_zip
            - wasm_local
        source_url:
          type:
            - string
            - "null"
        format_key:
          type:
            - string
            - "null"
        capabilities:
          type:
            - object
            - "null"
        resource_limits:
          type:
            - object
            - "null"
        installed_at:
          type: string
          format: date-time

    PluginEvent:
      type: object
      required:
        - id
        - plugin_id
        - event_type
        - message
        - created_at
      properties:
        id:
          type: string
          format: uuid
        plugin_id:
          type: string
          format: uuid
        event_type:
          type: string
        message:
          type: string
        created_at:
          type: string
          format: date-time

    FormatHandler:
      type: object
      required:
        - id
        - format_key
        - handler_type
        - display_name
        - extensions
        - is_enabled
      properties:
        id:
          type: string
          format: uuid
        format_key:
          type: string
        handler_type:
          type: string
          enum:
            - core
            - wasm
        display_name:
          type: string
        description:
          type:
            - string
            - "null"
        extensions:
          type: array
          items:
            type: string
        is_enabled:
          type: boolean
        plugin_id:
          type:
            - string
            - "null"
          format: uuid

    SigningKey:
      type: object
      required:
        - id
        - name
        - key_type
        - fingerprint
        - status
        - created_at
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        key_type:
          type: string
          enum:
            - rsa
            - gpg
        fingerprint:
          type: string
        repository_id:
          type:
            - string
            - "null"
          format: uuid
        status:
          type: string
          enum:
            - active
            - revoked
        created_at:
          type: string
          format: date-time
        expires_at:
          type:
            - string
            - "null"
          format: date-time

    SecurityScore:
      type: object
      required:
        - repository_id
        - repository_key
        - score
        - critical_count
        - high_count
        - medium_count
        - low_count
      properties:
        repository_id:
          type: string
          format: uuid
        repository_key:
          type: string
        score:
          type: string
          enum:
            - A
            - B
            - C
            - D
            - F
        critical_count:
          type: integer
        high_count:
          type: integer
        medium_count:
          type: integer
        low_count:
          type: integer
        last_scanned_at:
          type:
            - string
            - "null"
          format: date-time

    Scan:
      type: object
      required:
        - id
        - scanner
        - status
        - findings_count
        - created_at
      properties:
        id:
          type: string
          format: uuid
        artifact_id:
          type:
            - string
            - "null"
          format: uuid
        repository_id:
          type:
            - string
            - "null"
          format: uuid
        scanner:
          type: string
          enum:
            - trivy
            - grype
        status:
          type: string
          enum:
            - pending
            - running
            - completed
            - failed
        findings_count:
          type: integer
        started_at:
          type:
            - string
            - "null"
          format: date-time
        completed_at:
          type:
            - string
            - "null"
          format: date-time
        created_at:
          type: string
          format: date-time

    Finding:
      type: object
      required:
        - id
        - scan_id
        - vulnerability_id
        - severity
        - package_name
        - installed_version
        - title
        - acknowledged
      properties:
        id:
          type: string
          format: uuid
        scan_id:
          type: string
          format: uuid
        vulnerability_id:
          type: string
          description: CVE identifier
        severity:
          type: string
          enum:
            - critical
            - high
            - medium
            - low
            - negligible
        package_name:
          type: string
        installed_version:
          type: string
        fixed_version:
          type:
            - string
            - "null"
        title:
          type: string
        description:
          type:
            - string
            - "null"
        acknowledged:
          type: boolean
        acknowledged_by:
          type:
            - string
            - "null"
          format: uuid
        acknowledged_reason:
          type:
            - string
            - "null"

    SecurityPolicy:
      type: object
      required:
        - id
        - name
        - rules
        - is_enabled
        - created_at
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        rules:
          type: object
          description: "Policy rules, e.g. { block_severity: [\"critical\"], quarantine_severity: [\"high\"] }"
        repository_id:
          type:
            - string
            - "null"
          format: uuid
        is_enabled:
          type: boolean
        created_at:
          type: string
          format: date-time

    EdgeNode:
      type: object
      required:
        - id
        - name
        - region
        - url
        - status
        - cache_size_mb
        - capacity_mb
        - repositories
        - created_at
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        region:
          type: string
        url:
          type: string
          format: uri
        status:
          type: string
          enum:
            - healthy
            - degraded
            - offline
        cache_size_mb:
          type: integer
        capacity_mb:
          type: integer
        last_heartbeat:
          type:
            - string
            - "null"
          format: date-time
        repositories:
          type: array
          items:
            type: string
          description: Repository keys assigned to this edge node
        created_at:
          type: string
          format: date-time

    TransferSession:
      type: object
      required:
        - id
        - artifact_id
        - source_node_id
        - status
        - total_chunks
        - completed_chunks
        - total_bytes
        - transferred_bytes
        - created_at
      properties:
        id:
          type: string
          format: uuid
        artifact_id:
          type: string
          format: uuid
        source_node_id:
          type: string
          format: uuid
        target_node_id:
          type:
            - string
            - "null"
          format: uuid
        status:
          type: string
          enum:
            - pending
            - transferring
            - completed
            - failed
        total_chunks:
          type: integer
        completed_chunks:
          type: integer
        total_bytes:
          type: integer
        transferred_bytes:
          type: integer
        created_at:
          type: string
          format: date-time

    PeerConnection:
      type: object
      required:
        - id
        - node_id
        - peer_node_id
        - status
      properties:
        id:
          type: string
          format: uuid
        node_id:
          type: string
          format: uuid
        peer_node_id:
          type: string
          format: uuid
        latency_ms:
          type:
            - integer
            - "null"
        bandwidth_mbps:
          type:
            - number
            - "null"
        status:
          type: string
          enum:
            - connected
            - disconnected

    ScoredPeer:
      type: object
      required:
        - node_id
        - score
        - latency_ms
        - bandwidth_mbps
        - has_chunks
      properties:
        node_id:
          type: string
          format: uuid
        score:
          type: number
        latency_ms:
          type: integer
        bandwidth_mbps:
          type: number
        has_chunks:
          type: integer

    NetworkProfile:
      type: object
      required:
        - node_id
        - upload_bandwidth_mbps
        - download_bandwidth_mbps
        - max_concurrent_transfers
      properties:
        node_id:
          type: string
          format: uuid
        upload_bandwidth_mbps:
          type: number
        download_bandwidth_mbps:
          type: number
        max_concurrent_transfers:
          type: integer

    Backup:
      type: object
      required:
        - id
        - type
        - status
        - include_artifacts
        - created_at
      properties:
        id:
          type: string
          format: uuid
        type:
          type: string
          enum:
            - full
            - metadata
            - incremental
        status:
          type: string
          enum:
            - pending
            - running
            - completed
            - failed
        size_bytes:
          type:
            - integer
            - "null"
        include_artifacts:
          type: boolean
        created_at:
          type: string
          format: date-time
        completed_at:
          type:
            - string
            - "null"
          format: date-time

    SystemSettings:
      type: object
      additionalProperties: true
      description: Key-value settings map

    MigrationConnection:
      type: object
      required:
        - id
        - name
        - url
        - username
        - type
        - verified
        - created_at
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        url:
          type: string
          format: uri
        username:
          type: string
        type:
          type: string
          enum:
            - artifactory
            - nexus
        verified:
          type: boolean
        created_at:
          type: string
          format: date-time

    MigrationJob:
      type: object
      required:
        - id
        - connection_id
        - status
        - source_repos
        - target_repos
        - total_items
        - completed_items
        - failed_items
        - skipped_items
        - options
        - created_at
      properties:
        id:
          type: string
          format: uuid
        connection_id:
          type: string
          format: uuid
        status:
          type: string
          enum:
            - pending
            - running
            - paused
            - completed
            - failed
            - cancelled
        source_repos:
          type: array
          items:
            type: string
        target_repos:
          type: array
          items:
            type: string
        total_items:
          type: integer
        completed_items:
          type: integer
        failed_items:
          type: integer
        skipped_items:
          type: integer
        options:
          type: object
        created_at:
          type: string
          format: date-time
        started_at:
          type:
            - string
            - "null"
          format: date-time
        completed_at:
          type:
            - string
            - "null"
          format: date-time

    MigrationItem:
      type: object
      required:
        - id
        - job_id
        - source_path
        - target_path
        - status
        - size_bytes
      properties:
        id:
          type: string
          format: uuid
        job_id:
          type: string
          format: uuid
        source_path:
          type: string
        target_path:
          type: string
        status:
          type: string
          enum:
            - pending
            - transferring
            - completed
            - failed
            - skipped
        size_bytes:
          type: integer
        error_message:
          type:
            - string
            - "null"

    MigrationReport:
      type: object
      required:
        - job_id
        - total_items
        - completed_items
        - failed_items
        - skipped_items
        - total_bytes
        - transferred_bytes
        - duration_seconds
        - errors
      properties:
        job_id:
          type: string
          format: uuid
        total_items:
          type: integer
        completed_items:
          type: integer
        failed_items:
          type: integer
        skipped_items:
          type: integer
        total_bytes:
          type: integer
        transferred_bytes:
          type: integer
        duration_seconds:
          type: integer
        errors:
          type: array
          items:
            type: object

    MigrationAssessment:
      type: object
      required:
        - job_id
        - total_artifacts
        - total_size_bytes
        - format_breakdown
        - estimated_duration_seconds
        - warnings
      properties:
        job_id:
          type: string
          format: uuid
        total_artifacts:
          type: integer
        total_size_bytes:
          type: integer
        format_breakdown:
          type: object
          description: Map of format name to artifact count
          additionalProperties:
            type: integer
        estimated_duration_seconds:
          type: integer
        warnings:
          type: array
          items:
            type: string

    Build:
      type: object
      required:
        - id
        - number
        - name
        - status
        - created_at
      properties:
        id:
          type: string
          format: uuid
        number:
          type: integer
        name:
          type: string
        status:
          type: string
          enum:
            - pending
            - running
            - success
            - failed
        created_at:
          type: string
          format: date-time

    Package:
      type: object
      required:
        - id
        - name
        - repository_id
        - repository_key
        - format
        - version_count
        - total_downloads
        - created_at
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        repository_id:
          type: string
          format: uuid
        repository_key:
          type: string
        format:
          type: string
        latest_version:
          type:
            - string
            - "null"
        version_count:
          type: integer
        total_downloads:
          type: integer
        created_at:
          type: string
          format: date-time

    PackageVersion:
      type: object
      required:
        - version
        - artifact_id
        - size_bytes
        - download_count
        - published_at
      properties:
        version:
          type: string
        artifact_id:
          type: string
          format: uuid
        size_bytes:
          type: integer
        download_count:
          type: integer
        published_at:
          type: string
          format: date-time

    TreeNode:
      type: object
      required:
        - name
        - path
        - type
      properties:
        name:
          type: string
        path:
          type: string
        type:
          type: string
          enum:
            - file
            - directory
        size_bytes:
          type:
            - integer
            - "null"
          description: Size in bytes; null for directories
        children:
          type:
            - array
            - "null"
          items:
            $ref: "#/components/schemas/TreeNode"

    ChunkManifest:
      type: object
      required:
        - session_id
        - total_chunks
        - chunk_size_bytes
        - chunks
      properties:
        session_id:
          type: string
          format: uuid
        total_chunks:
          type: integer
        chunk_size_bytes:
          type: integer
        chunks:
          type: array
          items:
            type: object
            required:
              - index
              - offset
              - size
              - sha256
              - status
            properties:
              index:
                type: integer
              offset:
                type: integer
              size:
                type: integer
              sha256:
                type: string
              status:
                type: string

    SyncTask:
      type: object
      required:
        - id
        - edge_node_id
        - artifact_id
        - status
        - created_at
      properties:
        id:
          type: string
          format: uuid
        edge_node_id:
          type: string
          format: uuid
        artifact_id:
          type: string
          format: uuid
        status:
          type: string
          enum:
            - pending
            - syncing
            - completed
            - failed
        created_at:
          type: string
          format: date-time

    RemoteRepository:
      type: object
      required:
        - key
        - format
        - package_type
        - artifact_count
        - size_bytes
      properties:
        key:
          type: string
        format:
          type: string
        package_type:
          type: string
        artifact_count:
          type: integer
        size_bytes:
          type: integer

